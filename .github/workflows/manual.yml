name: Build AmneziaWG macOS

on:
  workflow_dispatch:

jobs:
  build-macos:
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install dependencies
        run: brew install swiftlint go
      
      - name: Configure project
        run: |
          cp Sources/WireGuardApp/Config/Developer.xcconfig.template Sources/WireGuardApp/Config/Developer.xcconfig
      
      - name: List available schemes
        run: xcodebuild -list -project WireGuard.xcodeproj
      
      - name: Build macOS app
        run: |
          xcodebuild -project WireGuard.xcodeproj \
                     -scheme "WireGuard macOS" \
                     -configuration Release \
                     -destination 'generic/platform=macOS' \
                     build \
                     CODE_SIGNING_ALLOWED=NO \
                     CODE_SIGN_IDENTITY="" \
                     CODE_SIGNING_REQUIRED=NO \
                     GCC_GENERATE_DEBUGGING_SYMBOLS=NO
      
      - name: Upload application
        uses: actions/upload-artifact@v4
        with:
          name: AmneziaWG-macOS-unsigned
          path: build/Release/AmneziaWG.app
          retention-days: 7
